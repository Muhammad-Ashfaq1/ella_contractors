name: Deploy Ella Contractors Module

on:
  push:
    branches:
      - main
    paths:
      - '**'

jobs:
  deploy-module:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        
      - name: Install sshpass
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass
          
      - name: Deploy Module to CRM
        run: |
          echo "Deploying Ella Contractors module..."
          
          # Create a clean deployment directory (excluding git files)
          mkdir -p ./deploy_temp
          rsync -av --exclude='.git/' --exclude='.github/' --exclude='.DS_Store' --exclude='*.log' --exclude='node_modules/' --exclude='vendor/' ./ ./deploy_temp/
          
          # Deploy only the clean module files
          sshpass -p "100xCjYLP8Bv2UfGbGPg" rsync -avz --delete --exclude='.git/' --exclude='.github/' --exclude='.DS_Store' --exclude='*.log' --exclude='node_modules/' --exclude='vendor/' ./deploy_temp/ dist-ashfaq@3.18.97.222:~/htdocs/dist.crm.ellasbubbles.com/modules/ella_contractors/
          
          # Clean up temp directory
          rm -rf ./deploy_temp
          
      - name: Completion Message
        run: echo "Module deployed successfully!"
