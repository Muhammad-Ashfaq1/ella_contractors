RewriteEngine On

# Allow direct access to module files
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Route media gallery requests (Perfex-compatible)
RewriteRule ^media/([0-9]+)/([a-zA-Z0-9]+)/?$ index.php/public_access/media/$1/$2 [L,QSA]
RewriteRule ^media/([0-9]+)/([a-zA-Z0-9]+)/download/([^/]+)/?$ index.php/public_access/download/$1/$2/$3 [L,QSA]
RewriteRule ^media/([0-9]+)/([a-zA-Z0-9]+)/view/([^/]+)/?$ index.php/public_access/view/$1/$2/$3 [L,QSA]

# Route default media gallery requests
RewriteRule ^default-media/([a-zA-Z0-9]+)/?$ index.php/public_access/default_media/$1 [L,QSA]
RewriteRule ^default-media/([a-zA-Z0-9]+)/download/([^/]+)/?$ index.php/public_access/download/0/$1/$2 [L,QSA]
RewriteRule ^default-media/([a-zA-Z0-9]+)/view/([^/]+)/?$ index.php/public_access/view/0/$1/$2 [L,QSA]

# Allow access to assets
RewriteRule ^assets/(.*)$ assets/$1 [L]
RewriteRule ^uploads/(.*)$ uploads/$1 [L]
