name: Deploy Ella Contractors Module

on:
  push:
    branches:
      - main
    paths:
      - '**'

jobs:
  deploy-module:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        
      - name: Install sshpass
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass
          
      - name: Deploy Module to CRM
        run: |
          echo "Deploying Ella Contractors module..."
          
          # Create a clean deployment directory (excluding git files and deploy_temp)
          mkdir -p ./deploy_temp
          rsync -av --exclude='.git/' --exclude='.github/' --exclude='.DS_Store' --exclude='*.log' --exclude='node_modules/' --exclude='vendor/' --exclude='deploy_temp/' ./ ./deploy_temp/
          
          # Deploy only the clean module files with proper SSH options and no deletion
          sshpass -p "gAYpe90UoL1RUgck0iDk" rsync -avz --no-times --no-perms --chmod=Du=rwx,Dg=rx,Fu=rw,Fg=r -e "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" ./deploy_temp/ awt-crm-ashfaq@34.224.171.98:~/htdocs/crm.allwetrade.com/modules/ella_contractors/
          
          # Clean up temp directory
          rm -rf ./deploy_temp
          
      - name: Completion Message
        run: echo "Module deployed successfully!"
